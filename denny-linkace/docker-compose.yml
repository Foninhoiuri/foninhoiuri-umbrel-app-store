version: "3.7"

services:
  app_proxy:
    environment:
      APP_HOST: denny-linkace_app_1
      APP_PORT: 80

  app:
    image: linkace/linkace:v2.1.8@sha256:266ea7ffe222bda918204b6b1bdaede8152f35ba6c24b693288af9df34e5a8f0
    restart: on-failure
    user: "0:0"
    depends_on:
      - db
      - redis
    volumes:
      - ${APP_DATA_DIR}/data/linkace_data:/app/storage:rw
    environment:
      APP_KEY: base64:vUSm5IuZpWi9Rb7y0gljDWGoTzCkpWMMScJxU8ypaTI=
      DB_CONNECTION: mysql
      DB_HOST: db
      DB_PORT: 3306
      DB_DATABASE: linkace
      DB_USERNAME: linkace
      DB_PASSWORD: s8QpJrNvXt7eGZ24
      REDIS_HOST: redis
      REDIS_PASSWORD: dFp72AxYjLkZ9vRN
      REDIS_PORT: 6379
      XDG_CONFIG_HOME: /app/storage/config
      XDG_DATA_HOME: /app/storage/data

  db:
    image: mariadb:12.0.1-rc@sha256:3e2de56a31d3710b2c28e3ee4de2016d3caddf8ac46abaf80f0f8781ef48e0f3
    restart: on-failure
    user: "0:0"
    command: mariadbd --character-set-server=utf8mb4 --collation-server=utf8mb4_bin
    environment:
      MYSQL_ROOT_PASSWORD: s8QpJrNvXt7eGZ24
      MYSQL_USER: linkace
      MYSQL_PASSWORD: s8QpJrNvXt7eGZ24
      MYSQL_DATABASE: linkace
    volumes:
      - ${APP_DATA_DIR}/mysql:/var/lib/mysql:rw

  redis:
    image: redis:8.0.2@sha256:1b835e5a8d5db58e8b718850bf43a68ef5a576fc68301fd08a789b20b4eecb61
    restart: on-failure
    user: "0:0"
    environment:
      REDIS_PASSWORD: dFp72AxYjLkZ9vRN
    volumes:
      - ${APP_DATA_DIR}/data/redis:/data:rw
