version: '3.7'

services:
  app_proxy:
    environment:
      APP_HOST: denny-homegallery_web_1
      APP_PORT: 3000

  web:
    image: xemle/home-gallery-api-server
    environment:
      - BACKEND=wasm
  gallery:
    image: xemle/home-gallery
    environment:
      - GALLERY_API_SERVER=http://api:3000
      - GALLERY_API_SERVER_CONCURRENT=1
      - GALLERY_API_SERVER_TIMEOUT=60
      - GALLERY_OPEN_BROWSER=false
      - GALLERY_WATCH_POLL_INTERVAL=300
      - GALLERY_BASE_DIR=data
      - GALLERY_CONFIG_DIR=data/config
    volumes:
      - ${APP_DATA_DIR}/data/hg_data:/data
      - ${APP_DATA_DIR}/data/pictures:/data/Pictures
      - ${APP_DATA_DIR}/data/config/gallery.config.yml:/data/config/gallery.config.yml:ro
    user: "1000:1000"
    entrypoint: ['node', '/app/gallery.js']
    command: ['run', 'server']
