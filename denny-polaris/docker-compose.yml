version: '3.7'

services:
  app_proxy:
    environment:
      APP_HOST: denny-polaris_web_1
      APP_PORT: 5050

  web:
    image: registry.gitlab.com/connectical/container/polaris
    restart: on-failure
    user: "100:100"  # UID/GID auf 100:100 setzen, wie in der Doku empfohlen
    volumes:
      - ${APP_DATA_DIR}/data/my/music/directory:/music
      - ${APP_DATA_DIR}/data/my/polaris/cache:/var/cache/polaris
      - ${APP_DATA_DIR}/data/my/polaris/data:/var/lib/polaris
    environment:
      POLARIS_PORT: 5050
    command: >
      /bin/sh -c "mkdir -p /var/cache/polaris /var/lib/polaris &&
                  chown -R 100:100 /var/cache/polaris /var/lib/polaris &&
                  exec run-polaris"
