version: '3'
services:
  pixelfed:
    image: pixelfed/pixelfed:latest
    restart: unless-stopped
    environment:
      - APP_ENV=production
      - APP_DEBUG=false
      - APP_KEY=your_random_generated_key_here
      - DB_CONNECTION=mysql
      - DB_HOST=db_host
      - DB_PORT=3306
      - DB_DATABASE=pixelfed
      - DB_USERNAME=pixelfed_user
      - DB_PASSWORD=pixelfed_password
      - CACHE_DRIVER=file
      - SESSION_DRIVER=file
      - QUEUE_DRIVER=sync
    ports:
      - "9757:4000"
    volumes:
      - pixelfed_data:/var/www/html/storage
    networks:
      - pixelfed_network

  pixelfed_live:
    image: pixelfed/pixelfed-live:latest
    restart: unless-stopped
    environment:
      - PIXELFED_URL=http://umbrel.local:9757
      - PIXELFED_SECRET=your-pixelfed-secret
    ports:
      - "1935:1935"
    networks:
      - pixelfed_network

networks:
  pixelfed_network:
    driver: bridge

volumes:
  pixelfed_data:
