version: '3.7'

services:
  app_proxy:
    environment:
      APP_HOST: denny-koito_web_1
      APP_PORT: 4110

  web:
    image: gabehf/koito:latest
    user: 1000:1000
    depends_on:
      - db
    environment:
      - KOITO_DATABASE_URL=postgres://postgres:postgrespassword@db:5432/denny-koito_db_1?sslmode=disable
      - KOITO_ALLOWED_HOSTS=*
      - KOITO_DEFAULT_USERNAME=admin
      - KOITO_DEFAULT_PASSWORD=umbrel
    restart: on-failure
    volumes:
      - ${APP_DATA_DIR}/data/koito_data:/etc/koito

  db:
    image: postgres:16
    user: 1000:1000
    restart: on-failure
    environment:
      POSTGRES_DB: denny-koito_db_1
      POSTGRES_USER: postgres
      POSTGRES_PASSWORD: postgrespassword
    volumes:
      - ${APP_DATA_DIR}/data/db_data:/var/lib/postgresql/data
