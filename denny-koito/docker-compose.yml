version: '3.7'

services:
  app_proxy:
    environment:
      APP_HOST: denny-koito_web_1
      APP_PORT: 4110

  web:
    image: gabehf/koito:latest
    depends_on:
      - db
    environment:
      - KOITO_DATABASE_URL=postgres://postgres:secret_password@db:5432/denny-koito_db_1
      - KOITO_ALLOWED_HOSTS=*
    volumes:
      - ${APP_DATA_DIR}/data/koito_data:/etc/koito
    restart: on-failure

  db:
    image: postgres:16
    restart: on-failure
    environment:
      POSTGRES_DB: denny-koito_db_1
      POSTGRES_USER: postgres
      POSTGRES_PASSWORD: secret_password
    volumes:
      - ${APP_DATA_DIR}/data/db_data:/var/lib/postgresql/data
