version: "3.9"
services:
  app_proxy:
    environment:
      APP_HOST: denny-privatebin_server_1
      APP_PORT: 8080
      PROXY_AUTH_ADD: "false"

  server:
    image: privatebin/nginx-fpm-alpine:1.7.4@sha256:4cc5f26f5b558b734cb084ada4fdacd75bd9f5e4574f3f3df54165b3623d6b86
    read_only: true
    restart: on-failure
    environment:
      - PUID=1000
      - PGID=1000
      - TZ=Europe/Berlin
    volumes:
      - '${APP_DATA_DIR}/privatebin-data:/srv/data' # data volume for pastes
      - '${APP_DATA_DIR}/conf.php:/srv/cfg/conf.php:ro' # second volume for custom configuration file
    expose:
      - "8080"

  nginx:
    image: nginx:latest
    container_name: nginx_proxy
    restart: unless-stopped
    ports:
      - "80:80"
      - "443:443"
    volumes:
      - ${APP_DATA_DIR}/nginx.conf:/etc/nginx/conf.d/default.conf
      - ${APP_DATA_DIR}/certificates:/certificates
    depends_on:
      - server
    networks:
      - proxy_network

networks:
  proxy_network:
    driver: bridge
